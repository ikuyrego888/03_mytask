<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>myMemoPad</title>
<script src="js/jquery-2.1.3.min.js"></script>
<link rel="stylesheet" href="./css/sample.css">
</head>
<body>
<header>
<h1>ğŸ‘¤ myTask ğŸ‘¤</h1>
</header>
<main>
    <input type="text" id="task" placeholder="input task...">
    <textarea id="memo" placeholder="input memo..."></textarea>
    <ul>
        <li id="save">save</li>
        <li id="done_select">done</li>
        <li id="clear_02">delete</li>
        <li id="clear_01">del All</li>
    </ul>
</main>
<table id="list">
    <!-- theadã«è¦‹å‡ºã—thã‚’ã‚»ãƒƒãƒˆã—ã€tbodyã«ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ ã—ã¦ã„ãï¼ˆã‚¿ã‚¹ã‚¯ã‚’prependæŒ¿å…¥ã™ã‚‹ãŸã‚ï¼‰ -->
    <thead>
        <tr>
            <th id="th_check"></th>
            <th>#task</th>
            <th>#memo</th>
            <th id="th_date">#date</th>
            <th class="th_button">sort</th>
            <th class="th_button">done</th>
            <th class="th_button">dele</th>
        </tr>
    </thead>
    <tbody>
    </tbody>

    <!-- ã“ã“ã«è¿½åŠ ãƒ‡ãƒ¼ã‚¿ãŒæŒ¿å…¥ã•ã‚Œã‚‹ -->
    <!-- ä»¥ä¸‹ã€ä¸¦ã³æ›¿ãˆç”¨ã®tbodyã€‚ä¸€æ—¦ä½œæˆã—ãŸãŒç†è§£ç”˜ãæ–­å¿µ -->
    <!-- <tbody id="tbody">
        <tr>
            <th id="th_check"></th>
            <th>#task</th>
            <th>#memo</th>
            <th id="th_date">#date</th>
            <th class="th_button">sort</th>
            <th class="th_button">done</th>
            <th class="th_button">dele</th>
        </tr>
    </tbody> -->
</table>

<table id="done_list">
    <thead>
        <tr>
            <th id="th_check"></th>
            <th>#done_task</th>
            <th>#memo</th>
            <th id="th_date">#date</th>
            <th class="th_button">sort</th>
            <th class="th_button">done</th>
            <th class="th_button">dele</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<script>

// 1ï¸âƒ£ Save ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
$("#save").on("click",function(){
    // å…¥åŠ›å†…å®¹
    const task = $("#task").val();
    const memo = $("#memo").val();
    
    // å…¥åŠ›å†…å®¹ãŒãªã„å ´åˆã¯ã‚¤ãƒ™ãƒ³ãƒˆçµ‚äº†
    if ( task == "" ){
        return;
    }

    // å…¥åŠ›æ—¥ã®è¨­å®š
    let now = new Date();
    let now_cv = now.toISOString(); //å¾Œæ®µã§JSONã‹ã‚‰å‡ºåŠ›ã™ã‚‹Dateè¡¨ç¤ºã«åˆã‚ã›ã¦å¤‰æ›ã—ã¦ãŠã
    console.log(now_cv);
    const now_date = now.getFullYear()+ "/" +(now.getMonth()+1)+ "/" +(now.getDate());
    // getmonthã®ï¼‹ï¼‘ã¯å¾Œã§ç¢ºèªğŸ’¡
    console.log(now_date);

    // å…¥åŠ›å†…å®¹ã‚’ï¼‘ã¤ã®å¤‰æ•°ã«ã¾ã¨ã‚ã‚‹ï¼ˆelementï¼‰
    let element = {now_cv,task,memo,now_date};

    // JSONã‚³ãƒ¼ãƒ‰ã§localStorageã«é…åˆ—ã¨ã—ã¦ãƒ‡ãƒ¼ã‚¿å–å¾—//
    localStorage.setItem(now_cv,JSON.stringify(element));
    const row = JSON.parse(localStorage.getItem(now_cv));
    console.log(localStorage);
    console.log(row);
    console.log(row.now_cv); // row.ãªãã¦ã‚‚åå¿œã™ã‚‹ã‘ã©åˆ†ã‹ã‚Šæ˜“ã„ã®ã§è¡¨ç¤º
    console.log(row.task); // row.ãªãã¦ã‚‚åå¿œã™ã‚‹ã‘ã©åˆ†ã‹ã‚Šæ˜“ã„ã®ã§è¡¨ç¤º
    console.log(row.memo); // row.ãªãã¦ã‚‚åå¿œã™ã‚‹ã‘ã©åˆ†ã‹ã‚Šæ˜“ã„ã®ã§è¡¨ç¤º
    console.log(row.now_date); // row.ãªãã¦ã‚‚åå¿œã™ã‚‹ã‘ã©åˆ†ã‹ã‚Šæ˜“ã„ã®ã§è¡¨ç¤º
    // console.log(localStorage);
    // let obj = JSON.parse(localStorage.getItem(now_cv));
    // console.log(obj);

    // ãƒ‡ãƒ¼ã‚¿ã‚’tableã«è¿½åŠ ã—ã¦ã„ã(è¡Œã®æŒ¿å…¥)
    // "tr"ã«ã¯valueã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã€‚å¾Œã§ã‚¿ã‚¹ã‚¯å‰Šé™¤ã™ã‚‹éš›ã«ã“ã®valueã‚’localstorageã®Keyã«ã™ã‚‹ç‚ºğŸ’¡
    let new_row = `<tr value="${row.now_cv}">
        <td><input type="checkbox" value="${row.now_cv}" class="checkBox"></td>
        <td> ${row.task} </td>
        <td class="td_memo"> ${row.memo} </td>
        <td class="td_date"> ${row.now_date} </td>
        <td class="updown"><button class="up"> <span id="up">${"â–²"}</span> </button><button class="down"> <span id="down">${"â–¼"}</span> </button></td>
        <td class="icon"><img src="img/iconDone_02.png" id="iconDone" class="done"></td>
        <td class="icon"><img src="img/iconDelete.png" id="iconDelete" class="delete"></td>
    </tr>`
    $("#list tbody").prepend(new_row);

    // å…¥åŠ›æ¬„ã®ãƒªã‚»ãƒƒãƒˆ
    $("#task").val("");
    $("#memo").val("");

    // deleteãƒœã‚¿ãƒ³ã§è¡Œã¨ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã™ã‚‹
    $(".delete").on("click",function(){
        let valKey = $(this).closest("tr").attr("value"); //å‰Šé™¤ã™ã‚‹è¡Œã®valueã‚’å–å¾—
        console.log(valKey);
        localStorage.removeItem(valKey); // valueã¨ä¸€è‡´ã™ã‚‹Keyã‚’localstorageã‹ã‚‰å‰Šé™¤
        $(this).closest("tr").remove(); // ã‚¿ã‚¹ã‚¯ã‹ã‚‰å‰Šé™¤
    })

    // é¸æŠã—ã¦å‰Šé™¤ã™ã‚‹
    $("#clear_02").on("click",function(){
        $("#list input[type=checkbox]:checked").each(function(){
            let valKey = $(this).closest("tr").attr("value"); //å‰Šé™¤ã™ã‚‹è¡Œã®valueã‚’å–å¾—
            // console.log(valKey);
            localStorage.removeItem(valKey); // valueã¨ä¸€è‡´ã™ã‚‹Keyã‚’localstorageã‹ã‚‰å‰Šé™¤
            $(this).closest("tr").remove(); // ã‚¿ã‚¹ã‚¯ã‹ã‚‰å‰Šé™¤
        })
    })

    // å®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯ã‚’done_listã¸ç§»å‹•ã™ã‚‹
    $(".done").on("click",function(){
        let doneTask = $(this).closest("tr");
        let doneID = doneTask.closest("table").attr("id");
        if( doneID == "done_list"){
            return; // done_listã«ç§»å‹•ã—ã¦ã„ã‚‹å ´åˆã¯å†åº¦ç§»å‹•ã•ã›ãªã„ï¼ˆï¼doneãƒœã‚¿ãƒ³åå¿œã•ã›ãªã„ï¼‰
        }
        $("#done_list tbody").prepend(doneTask);
        
        // å®Œäº†ã‚¿ã‚¹ã‚¯ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®Keyã‚’å‰Šé™¤ã—ã¦ã€Keyé ­ã«"done_"ã‚’ä»˜ã‘ãŸKeyã«ã—ã¦å†ã‚»ãƒƒãƒˆ
        now_cv = "done_" + now_cv;
        let done_ = {now_cv,task,memo,now_date};
        console.log(done_);
        localStorage.removeItem(row.now_cv);
        localStorage.setItem(now_cv,JSON.stringify(done_));
    })

    // é¸æŠã—ã¦å®Œäº†ã™ã‚‹
    $("#done_select").on("click",function(){
        $("#list input[type=checkbox]:checked").each(function(){
            let doneTask = $(this).closest("tr");
            let doneID = doneTask.closest("table").attr("id");
            if( doneID == "done_list"){
                return; // done_listã«ç§»å‹•ã—ã¦ã„ã‚‹å ´åˆã¯å†åº¦ç§»å‹•ã•ã›ãªã„ï¼ˆï¼doneãƒœã‚¿ãƒ³åå¿œã•ã›ãªã„ï¼‰
            }
            $(".checkBox").checked = false; //done_listã¸ç§»ã£ãŸã‚‰ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹å¤–ã—ãŸã„ã‘ã©åå¿œã—ãªã„...ğŸ’¡
            $("#done_list tbody").prepend(doneTask);

            // å®Œäº†ã‚¿ã‚¹ã‚¯ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®Keyã‚’å‰Šé™¤ã—ã¦ã€Keyé ­ã«"done_"ã‚’ä»˜ã‘ãŸKeyã«ã—ã¦å†ã‚»ãƒƒãƒˆ
            $(".checkBox:checked").each(function(){
                let checkedValue = $(this).val(); //æœ¬å½“ã¯"data-âšªï¸âšªï¸"ã‚’ä½¿ç”¨ã—ãŸã„ãŒä»Šå›ã¯valã§æ–­å¿µ...
                console.log(checkedValue);
                let doneCheck = JSON.parse(localStorage.getItem(checkedValue));
                console.log(doneCheck);
                // console.log(doneCheck.now_cv);
                now_cv = "done_" + doneCheck.now_cv;
                console.log(now_cv);
                let task = doneCheck.task;
                let memo = doneCheck.memo;
                let now_date = doneCheck.now_date;
                let done_ = {now_cv,task,memo,now_date};
                console.log(done_);
                localStorage.setItem(now_cv,JSON.stringify(done_));
                // ä»¥ä¸‹ã®removeã‚’è¨­å®šã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦æ¤œè¨¼ãƒ„ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼å‡ºã‚‹ãŒã€ä½¿ãˆã‚‹ã¯ä½¿ãˆã‚‹ã®ã§ä¸€æ—¦ã“ã‚Œã§è«¦ã‚ã‚‹
                localStorage.removeItem(doneCheck.now_cv);
            })
        })
    })

    // ä¸¦ã³æ›¿ãˆ ã†ã¾ãåå¿œã›ãšï¼ˆæ–­å¿µï¼‰
    // $(".up").on("click",function(){
    //     $("#tbody").clone(true).insertAfter($("#tbody>tr"));
    //     let upup = $(this).parent().parent();
    //     if (upup.next("tr")){
    //         upup.insertAfter(upup.next("tr")[0]);
    //     }
    // })
})

// 2ï¸âƒ£ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ï¼šä¿å­˜ãƒ‡ãƒ¼ã‚¿å–å¾—è¡¨ç¤º
// ãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã«localstorageã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹
for(let i=0; i<localStorage.length; i++){
    const element = localStorage.key(i) //ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®keyã‚’å–å¾—ã™ã‚‹å¤‰æ•°ã‚’elementã«ã€‚
    console.log(element);
    const row = JSON.parse(localStorage.getItem(element));
    console.log(row);
    console.log(row.now_cv);
    console.log(row.task);
    console.log(row.memo);
    console.log(row.now_date);

    // ãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã®tableãƒ‡ãƒ¼ã‚¿ã‚’å†ç¾ã™ã‚‹
    // "tr"ã«ã¯valueã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã€‚å¾Œã§ã‚¿ã‚¹ã‚¯å‰Šé™¤ã™ã‚‹éš›ã«ã“ã®valueã‚’localstorageã®Keyã«ã™ã‚‹ç‚ºğŸ’¡
    let new_row = `<tr value="${row.now_cv}">
        <td><input type="checkbox" value="${row.now_cv}" class="checkBox"></td>
        <td> ${row.task} </td>
        <td class="td_memo"> ${row.memo} </td>
        <td class="td_date"> ${row.now_date} </td>
        <td class="updown"><button class="up"> <span id="up">${"â–²"}</span> </button><button class="down"> <sapn id="down">${"â–¼"}</sapn> </button></td>
        <td class="icon"><img src="img/iconDone_02.png" id="iconDone" class="done"></td>
        <td class="icon"><img src="img/iconDelete.png" id="iconDelete" class="delete"></td>
    </tr>`
    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®Keyé ­ã«"done_"ãŒä»˜ã„ã¦ã„ãŸã‚‰#done_listã¸è¡¨ç¤ºï¼ˆãã‚Œä»¥å¤–ã¯#listã¸è¡¨ç¤ºï¼‰
    let doneKey = row.now_cv;
    if (doneKey.includes("done_")){
        // console.log(true);
        $("#done_list tbody").prepend(new_row)
    } else {
        // console.log(false);
        $("#list tbody").prepend(new_row)
    }

    //deleteãƒœã‚¿ãƒ³ã§è¡Œã¨ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã™ã‚‹//
    $(".delete").on("click",function(){
        let valKey = $(this).closest("tr").attr("value"); //å‰Šé™¤ã™ã‚‹è¡Œã®valueã‚’å–å¾—
        console.log(valKey);
        localStorage.removeItem(valKey); // valueã¨ä¸€è‡´ã™ã‚‹Keyã‚’localstorageã‹ã‚‰å‰Šé™¤
        $(this).closest("tr").remove(); // ã‚¿ã‚¹ã‚¯ã‹ã‚‰å‰Šé™¤
    })

    //é¸æŠã—ã¦å‰Šé™¤ã™ã‚‹//
    $("#clear_02").on("click",function(){
        $("#list input[type=checkbox]:checked").each(function(){
            let valKey = $(this).closest("tr").attr("value"); //å‰Šé™¤ã™ã‚‹è¡Œã®valueã‚’å–å¾—
            // console.log(valKey);
            localStorage.removeItem(valKey); // valueã¨ä¸€è‡´ã™ã‚‹Keyã‚’localstorageã‹ã‚‰å‰Šé™¤
            $(this).closest("tr").remove(); // ã‚¿ã‚¹ã‚¯ã‹ã‚‰å‰Šé™¤
        })
    })

    // å®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯ã‚’done_listã¸ç§»å‹•ã™ã‚‹
    $(".done").on("click",function(){
        let doneTask = $(this).closest("tr");
        let doneID = doneTask.closest("table").attr("id");
        if( doneID == "done_list"){
            return; // done_listã«ç§»å‹•ã—ã¦ã„ã‚‹å ´åˆã¯å†åº¦ç§»å‹•ã•ã›ãªã„ï¼ˆï¼doneãƒœã‚¿ãƒ³åå¿œã•ã›ãªã„ï¼‰
        }
        $("#done_list tbody").prepend(doneTask);

        // å®Œäº†ã‚¿ã‚¹ã‚¯ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®Keyã‚’å‰Šé™¤ã—ã¦ã€Keyé ­ã«"done_"ã‚’ä»˜ã‘ãŸKeyã«ã—ã¦å†ã‚»ãƒƒãƒˆ
        localStorage.removeItem(row.now_cv);
        now_cv = "done_" + row.now_cv;
        task = row.task;
        memo = row.memo;
        now_date = row.now_date;
        let done_ = {now_cv,task,memo,now_date};
        console.log(done_);
        localStorage.setItem(now_cv,JSON.stringify(done_));
    })

    // é¸æŠã—ã¦å®Œäº†ã™ã‚‹
    $("#done_select").on("click",function(){
        $("#list input[type=checkbox]:checked").each(function(){
            let doneTask = $(this).closest("tr");
            let doneID = doneTask.closest("table").attr("id");
            if( doneID == "done_list"){
                return; // done_listã«ç§»å‹•ã—ã¦ã„ã‚‹å ´åˆã¯å†åº¦ç§»å‹•ã•ã›ãªã„ï¼ˆï¼doneãƒœã‚¿ãƒ³åå¿œã•ã›ãªã„ï¼‰
            }
            $(".checkBox").checked = false; //done_listã¸ç§»ã£ãŸã‚‰ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹å¤–ã—ãŸã„ã‘ã©åå¿œã—ãªã„...ğŸ’¡
            $("#done_list tbody").prepend(doneTask);
            
            // å®Œäº†ã‚¿ã‚¹ã‚¯ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®Keyã‚’å‰Šé™¤ã—ã¦ã€Keyé ­ã«"done_"ã‚’ä»˜ã‘ãŸKeyã«ã—ã¦å†ã‚»ãƒƒãƒˆ
            $(".checkBox:checked").each(function(){
                let checkedValue = $(this).val(); //æœ¬å½“ã¯"data-âšªï¸âšªï¸"ã‚’ä½¿ç”¨ã—ãŸã„ãŒä»Šå›ã¯valã§æ–­å¿µ...
                console.log(checkedValue);
                let doneCheck = JSON.parse(localStorage.getItem(checkedValue));
                console.log(doneCheck);
                console.log(doneCheck.now_cv);
                now_cv = "done_" + doneCheck.now_cv;
                console.log(now_cv);
                task = doneCheck.task;
                memo = doneCheck.memo;
                now_date = doneCheck.now_date;
                let done_ = {now_cv,task,memo,now_date};
                console.log(done_);
                localStorage.setItem(now_cv,JSON.stringify(done_));
                // ä»¥ä¸‹ã®removeã‚’è¨­å®šã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦æ¤œè¨¼ãƒ„ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼å‡ºã‚‹ãŒã€ä½¿ãˆã‚‹ã¯ä½¿ãˆã‚‹ã®ã§ä¸€æ—¦ã“ã‚Œã§è«¦ã‚ã‚‹
                localStorage.removeItem(doneCheck.now_cv);
            })
        })
    })
}

// 3ï¸âƒ£ clear ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
$("#clear_01").on("click",function(){
    localStorage.clear();
    $("#list td").remove();
    $("#done_list td").remove();
})

</script>
<footer><small></small></footer>
</body>
</html>